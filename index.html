<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horloge CTU</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CTU">
  <link rel="apple-touch-icon" href="icon-512.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      transition: background 0.3s, color 0.3s;
    }
    @media (prefers-color-scheme: dark) {
      body { background: #121212; color: #e0e0e0; }
    }
    @media (prefers-color-scheme: light) {
      body { background: #ffffff; color: #222222; }
    }
    h1 { font-size: 2.5em; margin: 0.2em 0; }
    h2 { font-size: 1.5em; margin: 0.2em 0; }
    .small { font-size: 0.9em; opacity: 0.7; }
  </style>
</head>
<body>
  <h1 id="date"></h1>
  <h2 id="time"></h2>
  <div id="title" class="small">Universal Earth Calendar (UEC)</div>

  <script>
    if (navigator.language === 'fr-FR') {
      document.getElementById("title").textContent = 'Calendrier Terrestre Universel (CTU)';
    }
    
    const LUNITIONS = [
      "Nuiron", "Kelva", "Drenae", "Vellune", "Rokel", "Cereon",
      "Elvora", "Zailun", "Aruel", "Thylis", "Velunor", "Ombran", "Siliane"
    ];

    const SPINION_DURATION = 86400;
    const NUIRON_DURATION = 11;
    const LUNITION_DURATION = 29;

    // --- Conversion en Jour Julien ---
    function toJulianDate(date = new Date()) {
      let year = date.getUTCFullYear();
      let month = date.getUTCMonth() + 1;
      let day = date.getUTCDate() +
                  date.getUTCHours()/24 +
                  date.getUTCMinutes()/1440 +
                  date.getUTCSeconds()/86400 +
                  date.getUTCMilliseconds()/86400000;

      let Y = year;
      let M = month;
      if (M <= 2) { Y -= 1; M += 12; }

      let A = Math.floor(Y/100);
      let B = 2 - A + Math.floor(A/4);

      return Math.floor(365.25*(Y+4716)) + Math.floor(30.6001*(M+1)) + day + B - 1524.5;
    }

    // UEC Origin : June 15th -763 BC 12:00pm GMT+3 â‰ˆ 09:00am UTC
    // The Assyrian eclipse, also known as the Bur-Sagale eclipse.
    // The first precisely dated astronomical event
    const originDateUEC = new Date(Date.UTC(-762, 5, 15, 9, 0, 0)); 
    const ORIGIN_JD = toJulianDate(originDateUEC);

    function updateCTU() {
      let jdNow = toJulianDate(now);
      let elapsedDays = jdNow - ORIGIN_JD;
      let elapsedSeconds = elapsedDays * SPINION_DURATION;

      // --- Calcul Orbion ---
      let orbion = Math.floor(elapsedDays / 365.2422);
      let spinionOfOrbion = Math.floor(elapsedDays % 365.2422);

      let lunition, spinion;
      if (orbion === 0 && spinionOfOrbion === 0) {
        // Instant 0 : 1/1/0
        lunition = 1;
        spinion = 1;
      } else {
        if (orbion > 0) {
          // Usual Orbion : Nuiron exist
          if (spinionOfOrbion < NUIRON_DURATION) {
            lunition = 0;
            spinion = spinionOfOrbion; // with spinion 0
          } else {
            spinionOfOrbion -= NUIRON_DURATION;
            lunition = Math.floor(spinionOfOrbion / LUNITION_DURATION) + 1;
            spinion = spinionOfOrbion % LUNITION_DURATION;
          }
        } else {
          // Orbion 0 after instant 0
          lunition = Math.floor(spinionOfOrbion / LUNITION_DURATION) + 1;
          spinion = spinionOfOrbion % LUNITION_DURATION;
        }

        if (spinion === 0) {
          spinion = 0;
        } else {
          spinion += 1; 
        }
      }

      //const lunitionName = LUNITIONS[lunition % 13];
      lunition %= 13;
      let lunitionName = lunition===0 ? 'Nuiron' : (new Date(2000, lunition-1, 10)).toLocaleDateString(navigator.language, { lunition: 'long' });
      lunitionName = lunitionName.charAt(0).toUpperCase() + lunitionName.slice(1);

      // UEC Time (Spinor/Minor/Secor)
      let secondsToSpinion = (elapsedSeconds % SPINION_DURATION);
      let spinor = Math.floor((secondsToSpinion / SPINION_DURATION) * 20);
      let minor = Math.floor(((secondsToSpinion / SPINION_DURATION) * 2000) % 100);
      let secor = Math.floor(((secondsToSpinion / SPINION_DURATION) * 200000) % 100);

      document.getElementById("date").textContent = `${spinion} ${lunitionName} ${orbion}`;
      document.getElementById("time").textContent =
        `${spinor.toString().padStart(2,'0')}:${minor.toString().padStart(2,'0')}:${secor.toString().padStart(2,'0')} CTU`;

      requestAnimationFrame(updateCTU);
    }

    updateCTU();
  </script>
</body>
</html>
