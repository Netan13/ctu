<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horloge CTU</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CTU">
  <link rel="apple-touch-icon" href="icon-512.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      transition: background 0.3s, color 0.3s;
    }
    @media (prefers-color-scheme: dark) {
      body { background: #121212; color: #e0e0e0; }
    }
    @media (prefers-color-scheme: light) {
      body { background: #ffffff; color: #222222; }
    }
    h1 { font-size: 2.5em; margin: 0.2em 0; }
    h2 { font-size: 1.5em; margin: 0.2em 0; }
    .small { font-size: 0.9em; opacity: 0.7; }
  </style>
</head>
<body>
  <h1 id="date"></h1>
  <h2 id="time"></h2>
  <div id="title" class="small">Universal Earth Calendar (UEC)</div>

  <script>
    if (navigator.language === 'fr-FR') {
      document.getElementById("title").textContent = 'Calendrier Terrestre Universel (CTU)';
    }
    
    const moisCTU = [
      "Nuiron", "Kelva", "Drenae", "Vellune", "Rokel", "Cereon",
      "Elvora", "Zailun", "Aruel", "Thylis", "Velunor", "Ombran", "Siliane"
    ];

    const SPINION_DURATION = 86400; // secondes
    const MOIS0_JOURS = 11;         // Nuiron
    const MOIS_JOURS = 29;          // mois normaux

    // --- Conversion en Jour Julien ---
    function toJulianDate(date) {
      const year = date.getUTCFullYear();
      const month = date.getUTCMonth() + 1;
      const day = date.getUTCDate() +
                  date.getUTCHours()/24 +
                  date.getUTCMinutes()/1440 +
                  date.getUTCSeconds()/86400 +
                  date.getUTCMilliseconds()/86400000;

      let Y = year;
      let M = month;
      if (M <= 2) { Y -= 1; M += 12; }

      const A = Math.floor(Y/100);
      const B = 2 - A + Math.floor(A/4);

      return Math.floor(365.25*(Y+4716)) + Math.floor(30.6001*(M+1)) + day + B - 1524.5;
    }

    // Origine CTU : 15 juin -763 12:00 GMT+3 ≈ 09:00 UTC
    const originDateUTC = new Date(Date.UTC(-762, 5, 15, 9, 0, 0)); 
    const ORIGIN_JD = toJulianDate(originDateUTC);

    function updateCTU() {
      const now = new Date();
      const jdNow = toJulianDate(now);
      const elapsedDays = jdNow - ORIGIN_JD;
      const elapsedSeconds = elapsedDays * SPINION_DURATION;

      // --- Calcul année sociale ---
      let year = Math.floor(elapsedDays / 365.2422);
      let dayOfYear = Math.floor(elapsedDays % 365.2422);

      let month, day;
      if (year === 0 && dayOfYear === 0) {
        // Instant 0 : 1/1/0
        month = 1;
        day = 1;
      } else {
        if (year > 0) {
          // Années normales : Nuiron existe
          if (dayOfYear < MOIS0_JOURS) {
            month = 0;
            day = dayOfYear; // jour 0 inclus
          } else {
            dayOfYear -= MOIS0_JOURS;
            month = Math.floor(dayOfYear / MOIS_JOURS) + 1;
            day = dayOfYear % MOIS_JOURS;
          }
        } else {
          // Année 0 après instant 0
          month = Math.floor(dayOfYear / MOIS_JOURS) + 1;
          day = dayOfYear % MOIS_JOURS;
        }

        // Jour 0 si divisible exact
        if (day === 0) {
          day = 0; // jour d'ajustement
        } else {
          day += 1; // sinon on commence à 1
        }
      }

      //const monthName = moisCTU[month % 13];
      month %= 13;
      const monthName = month===0 ? 'Nuiron' : (new Date(2000, month-1, 10)).toLocaleString(navigator.language, { month: 'long' });
      monthName = monthName.charAt(0).toUpperCase() + monthName.slice(1);

      // Heure CTU (Spinor/Minor/Secor)
      const secondsToday = (elapsedSeconds % SPINION_DURATION);
      const spinor = Math.floor((secondsToday / SPINION_DURATION) * 20);
      const minor = Math.floor(((secondsToday / SPINION_DURATION) * 2000) % 100);
      const secor = Math.floor(((secondsToday / SPINION_DURATION) * 200000) % 100);

      document.getElementById("date").textContent = `${day} ${monthName} ${year}`;
      document.getElementById("time").textContent =
        `${spinor.toString().padStart(2,'0')}:${minor.toString().padStart(2,'0')}:${secor.toString().padStart(2,'0')} CTU`;

      requestAnimationFrame(updateCTU);
    }

    updateCTU();
  </script>
</body>
</html>
